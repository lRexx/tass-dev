<!-- TICKET UPDATE FORM -->
<div id="UpdateModalTicket" class="modal fade bd-example-modal-lg" style="top: -10px;" role="dialog">
  <div class="modal-dialog modal-xl" >
    <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true"><i alt="Cerrar" class="glyphicon glyphicon-remove-sign"> </i></span><span class="sr-only">Close</span></button>
            <h3 class="modal-title">
                <i ng-if="tkupdate.idTypeTicketKf==1" class="fas fa-key"></i>
                <i ng-if="tkupdate.idTypeTicketKf==2" class="fas fa-key"></i>
                <i ng-if="tkupdate.idTypeTicketKf==3" class="fas fa-wrench"></i>
            [{{tkupdate.codTicket}}] - <span class="label label-info" >{{tkupdate.typeticket.TypeTicketName}}</span>
            <span ng-if="tkupdate.refundsDetails!=undefined && tkupdate.refundsDetails.length>=1" class="dropdown">
              <button class="btn btn-default dropdown-toggle font-size-16px" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="false">
                <i class="i-warning fas fa-bell"></i>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                <li ng-repeat="refund in tkupdate.refundsDetails" role="presentation">
                  <a style="cursor: pointer;" class="clear-lazy-cache" ng-click="showRefund(refund);" tabindex="-1" role="menuitem">
                    <span ng-class="{'badge badge-warning': refund.idRefundTypeKf=='1', 'badge badge-success': refund.idRefundTypeKf=='2' }"><i class="fas fa-hand-holding-usd"></i></span>
                    <span> {{refund.created_at | toDate | date:'dd-MM-yyyy'}}&nbsp;</span>
                    <span>:: Reintegro de &nbsp;</span>
                    <span class="label label-default">{{refund.refundAmount | number:2}} &nbsp;</span>
                    <span ng-class="{'label label-warning': refund.idRefundTypeKf=='1', 'label label-success': refund.idRefundTypeKf=='2' }">{{refund.refundName}}</span>
                    
                  </a>
              </ul>
            </span>
          </h3>
        </div>
        <!-- PARA CONSULTAS tkupdate.typeticket.TypeTicketName.substr(20,9) tk.idStatusTicketKf=='12' && tk.idTypeTicketKf=='2'-->
        <div class="modal-body"  style="overflow-y: scroll;">
            <!-- FORM CONTAINER-->
            <form class="form-horizontal" name="fUpdateTicket" novalidate>
                <fieldset>
                    <div  class="col-md-12 col-xs-12 well-checkbox n-margin-l customer-frame">
                        <!-- LEFT COLUMN -->
                        <div class="col-md-6 col-xs-12 n-padding-l n-padding-r">
                          <div class="col-md-12 col-xs-12">
                            <span> N째 de Ticket: {{tkupdate.codTicket}}</span>
                          </div>
                          <div class="col-md-12"><span>Realizado por: {{tkupdate.userMadeBy.fullNameUser}}</span> <span data-toggle="tooltip" data-placement="top"  title="Perfil" style="font-size: 85%;" class="badge badge-warning">{{tkupdate.userMadeBy.nameProfile}}</span></div>
                          <div class="col-md-12"><span>Solicitado por: {{tkupdate.userRequestBy.fullNameUser}}</span> <span data-toggle="tooltip" data-placement="top"  title="Perfil" style="font-size: 85%;" class="badge badge-warning">{{tkupdate.userRequestBy.nameProfile}}</span></div>
                          <div class="col-md-12">
                              <span>Estado: 
                              <span ng-if="tkupdate.isCancelRequested=='1' || tkupdate.isCancelRequested!='1'" class="label" ng-class="{  
                                'label-default': 
                                tkupdate.idStatusTicketKf=='8',
                                'label-success':  
                                tkupdate.idStatusTicketKf=='1' || tkupdate.idStatusTicketKf=='5',
                                'label-warning':  
                                tkupdate.idStatusTicketKf=='3' || tkupdate.idStatusTicketKf=='4' || tkupdate.idStatusTicketKf=='10' || tkupdate.idStatusTicketKf=='2' || tkupdate.idStatusTicketKf=='7' || tkupdate.idStatusTicketKf=='9' || tkupdate.idStatusTicketKf=='11' || tkupdate.idStatusTicketKf=='12',
                                'label-danger':  
                                tkupdate.idStatusTicketKf=='6',
                              }">{{tkupdate.statusTicket.statusName}}</span>
                              </span>
                              <button ng-if="sysLoggedUser.idProfileKf==1 && (tkupdate.idStatusTicketKf==2 || tkupdate.idStatusTicketKf==9 || tkupdate.idStatusTicketKf==11) && (sysLoggedUser.idProfileKf==1 || sysLoggedUser.idProfileKf==4) && tkupdate.isCancelRequested!=1"  data-toggle="tooltip" data-placement="bottom" title="Aprobar" type="button" style="margin-left: 0.5%" ng-click="mainSwitchFn('approveTicket', tkupdate)" class="btn btn-sm btn-success"><i class="fas fa-check"></i></button>
                              <button ng-if="sysLoggedUser.idProfileKf==1 && tkupdate.idTypeTicketKf<=2 && (tkupdate.idStatusTicketKf=='4' || tkupdate.idStatusTicketKf=='5' || tkupdate.idStatusTicketKf=='7' || tkupdate.idStatusTicketKf=='8')" ng-click="mainSwitchFn('change_ticket_status', tkupdate, null)" data-toggle="tooltip" data-placement="bottom" title="Cambiar estatus" type="button" style="margin-left: 0.5%" class="btn btn-sm btn-primary"><i class="fas fa-sync"></i></button>
                              <button ng-if="((tkupdate.idStatusTicketKf!=6 && tkupdate.idStatusTicketKf!=1) ||  (tkupdate.idStatusTicketKf==10 && tkupdate.isCancelRequested==1)) && (sysLoggedUser.idProfileKf=='1' || sysLoggedUser.idProfileKf=='4')" ng-click="modalConfirmation('cancel_sys',0, tkupdate)" data-toggle="tooltip" data-placement="bottom" title="Cancelar pedido" type="button" style="margin-left: 0.5%" class="btn btn-sm btn-danger"><i class="fas fa-ban"></i></button>
                              <button ng-if="sysLoggedUser.idProfileKf!=1 && tkupdate.idTypeTicketKf<=2 && (tkupdate.idStatusTicketKf=='10' && tkupdate.isCancelRequested!='1')" ng-click="modalConfirmation('cancel_user',0, tkupdate)" data-toggle="tooltip" data-placement="bottom" title="Cancelar pedido" type="button" style="margin-left: 0.5%" class="btn btn-sm btn-danger"><i class="fas fa-ban"></i></button>
                          </div>
                        </div>
                        <!-- RIGHT COLUMN -->
                        <div class="col-md-6 col-xs-12 n-padding-l n-padding-r">
                          <div class="col-md-12 col-xs-12">
                            <span ng-if="tkupdate.building!=null && tkupdate.building!=undefined"> Administraci처n: {{tkupdate.clientAdmin.name}}</span>
                          </div>
                          <div ng-if="tkupdate.building!=null && tkupdate.building!=undefined" class="col-md-12"><span> Consorcio: {{tkupdate.building.name}}</span></div>
                          <div ng-if="tkupdate.idTypeRequestFor=='1' && tkupdate.building!=null && tkupdate.building!=undefined" class="col-md-12"><span> Departamento: </span>
                            <span class="label label-default text-uppercase">{{tkupdate.department.floor}}-{{tkupdate.department.departament}}</span>
                            <span ng-click="modalConfirmation('approveDepto', 0, tkupdate)" data-toggle="tooltip" data-placement="top"  title="Autorizar propietario" ng-if="sysLoggedUser.idProfileKf==1 && tkupdate.department.isAprobatedAdmin!=1 && tkupdate.department.idUserKf==tkupdate.userRequestBy.idUser && (tkupdate.userRequestBy.idProfileKf=='3' || tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='1' && tkupdate.idStatusTicketKf!='6'" class="label label-warning text-uppercase"><i class="fas fa-lock"></i></span>
                            <span ng-click="modalConfirmation('approveDepto', 0, tkupdate)" data-toggle="tooltip" data-placement="top"  title="Autorizar Habitante" ng-if="sysLoggedUser.idProfileKf==1 && tkupdate.userRequestBy.isDepartmentApproved==null && (tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='5' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='2' && tkupdate.idStatusTicketKf!='6'" class="label label-warning text-uppercase"><i class="fas fa-lock"></i></span>
                            <span data-toggle="tooltip" data-placement="top"  title="Autorizaci처n Pendiente" ng-if="(sysLoggedUser.idProfileKf==1 && tkupdate.department.isAprobatedAdmin!=1 && tkupdate.department.idUserKf==tkupdate.userRequestBy.idUser && (tkupdate.userRequestBy.idProfileKf=='3' || tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='1' && tkupdate.idStatusTicketKf!='6') || (sysLoggedUser.idProfileKf==1 && tkupdate.userRequestBy.isDepartmentApproved==null && (tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='5' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='2' && tkupdate.idStatusTicketKf!='6')" class="badge badge-warning">Autorizaci처n pendiente</span>
                            <span data-toggle="tooltip" data-placement="top"  title="Autorizado" ng-if="(tkupdate.department.isAprobatedAdmin==1 && tkupdate.department.idUserKf==tkupdate.userRequestBy.idUser && (tkupdate.userRequestBy.idProfileKf=='3' || tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='1') || (tkupdate.userRequestBy.isDepartmentApproved!=null && (tkupdate.userRequestBy.idProfileKf=='4' || tkupdate.userRequestBy.idProfileKf=='5' || tkupdate.userRequestBy.idProfileKf=='6') && tkupdate.userRequestBy.idTypeTenantKf=='2')" class="label label-success text-uppercase"><i class="fas fa-user-check"></i></span>
                          </div>
                          <div ng-if="tkupdate.idTypeRequestFor!='1'" class="col-md-12"><span> Tipo: </span><span class="label label-default text-uppercase">{{tkupdate.typeRequestFor.name}}</span></div>
                          <!--<div class="col-md-12"><span> Costo: </span>
                            <span style="color:rgb(250, 107, 107);background: #fff;border-radius: 10px;padding-left: 5px; padding-right: 5px; font-size: 18px;" ng-if="tkupdate.total!=null && tkupdate.total!=undefined && tkupdate.total!='NaN'">{{tkupdate.total | number:2}}</span>
                            <span ng-if="tkupdate.total==null || tkupdate.total==undefined || tkupdate.total=='NaN'" class="label label-default">n/a</span>
                          </div>-->
                          <div class="col-md-12"><span>Creado: </span><span>{{ tkupdate.created_at | toDate | date:'dd-MM-yyyy HH:mm:ss' }}</span></div>
                          <div ng-if="sysLoggedUser.idProfileKf==1" class="col-md-12"><span>Internet: </span>
                              <!-- It Has internet -->
                              <span ng-if="tkupdate.building.isHasInternetOnline!=undefined && tkupdate.building.isHasInternetOnline=='true'" data-toggle="tooltip" data-placement="top" title="Si" class="font-size-18px"><i class="text-success fas fa-check-circle"></i></span>
                              <span ng-if="(tkupdate.building.isHasInternetOnline==undefined || tkupdate.building.isHasInternetOnline==null || tkupdate.building.isHasInternetOnline=='false')" data-toggle="tooltip" data-placement="top" title="No" class="font-size-18px"><i class="text-danger fas fa-times-circle"></i></span>
                          </div>
                          <div ng-if="tkupdate.delivery_schedule_at!=null" class="col-md-12"><span>Entrega estimada: </span><span>{{ tkupdate.delivery_schedule_at | toDate | date:'dd-MM-yyyy' }}</span></div>
                          <div ng-if="tkupdate.delivered_at!=null" class="col-md-12">
                            <span ng-if="tkupdate.idTypeDeliveryKf=='1'">Retiro realizado: </span>
                            <span ng-if="tkupdate.idTypeDeliveryKf=='2'">Entrega realizada: </span>
                            <span>{{ tkupdate.delivered_at | toDate | date:'dd-MM-yyyy' }}</span></div>
                        </div>
                        <div  class="col-md-12 col-xs-12">
                          <legend style="text-align: left;">Costos</legend>
                          <div class="col-md-3 col-xs-3 text-center">
                            <div class="col">
                              <div class="counter-ticket">
                                <!-- <i class="fas fa-handshake fa-lg fa-ticket-2x"></i>-->
                                <h2 class="timer count-ticket-title count-number" data-to="100" data-speed="1500">$ {{tkupdate.costService  | number:0}}</h2>
                                <p class="count-ticket-text ">Gestion</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-3 col-xs-6 text-center">
                            <div class="col">
                              <div class="counter-ticket">
                                <!-- <i class="fas fa-key fa-lg fa-ticket-2x"></i>-->
                                <h2 class="timer count-ticket-title count-number" data-to="100" data-speed="1500">$ {{tkupdate.costKeys  | number:0}}</h2>
                                <p class="count-ticket-text ">Llaveros</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-3 col-xs-6 text-center">
                            <div class="col">
                              <div class="counter-ticket">
                                <!-- <i class="fas fa-truck fa-lg fa-ticket-2x"></i>-->
                                <h2 class="timer count-ticket-title count-number" data-to="100" data-speed="1500">$ {{tkupdate.costDelivery  | number:0}}</h2>
                                <p class="count-ticket-text ">Env챠o</p>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-3 col-xs-6 text-center">
                            <div class="col">
                              <div class="counter-ticket">
                                <!-- <i class="fas fa-file-invoice-dollar fa-lg fa-ticket-2x"></i>-->
                                <h2 class="timer count-ticket-title count-number" data-to="100" data-speed="1500">$ {{tkupdate.total  | number:0}}</h2>
                                <p class="count-ticket-text ">Total</p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div ng-if="tkupdate.billingReceiptDetails.length>0" class="col-md-12 col-xs-12" style="margin-top: 20px;">
                          <legend style="text-align: left;">Factura</legend>
                            <ul class="file-list file-list-5">
                              <li ng-repeat="file in tkupdate.billingReceiptDetails">
                                <a data-toggle="tooltip" data-placement="top" title="{{file.title | limitTo: 20 }}{{file.title.length > 20 ? '...' : ''}}" ng-if="file.typeFile.substr(0,5)=='image'" class="thumbnail" ng-click="openLightboxModal(customer.files.files_uploaded, $index)">
                                  <img ng-src="{{file.urlFile}}" />               
                                </a>
                                <!--<a data-toggle="tooltip" data-placement="top" title="{{file.title | limitTo: 20 }}{{file.title.length > 20 ? '...' : ''}}" ng-if="file.typeFile=='application/pdf'" ng-click="openPDFViewerModal(file.urlFile)" class="thumbnail">
                                  <img src="images/pdf-thumb.png" ng-if="file.typeFile=='application/pdf'"/>
                                </a>-->
                                <a data-toggle="tooltip" data-placement="top" title="{{file.title | limitTo: 20 }}{{file.title.length > 20 ? '...' : ''}}" ng-if="file.typeFile.substr(0,5)!='image' && file.typeFile!='application/pdf'" class="thumbnail">
                                  <img src="images/doc-thumb.png" ng-if="file.typeFile=='application/vnd.openxmlformats-officedocument.wordprocessingml.document' || file.typeFile=='application/msword'"/>
                                  <img src="images/excel-thumb.png" ng-if="file.typeFile=='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || file.typeFile=='application/vnd.ms-excel'"/>                 
                                </a>
                                <div class="caption">
                                  <span class="label label-default">{{file.title | limitTo: 20 }}{{file.title.length > 20 ? '...' : ''}}</span><br/><br/>
                                  <button type="button" data-toggle="tooltip" data-placement="bottom" title="Bajar archivo" class="btn btn-success btn-xs" ng-click="downloadFile(file)">
                                      <i class="fas fa-cloud-download-alt"></i>
                                  </button>
                                  <button ng-if="file.typeFile.substr(0,5)=='image'" type="button" data-toggle="tooltip" data-placement="bottom" title="Ver archivo" class="btn btn-warning btn-xs" ng-click="openLightboxModal(customer.files.files_uploaded, $index)">
                                      <i class="far fa-eye"></i>
                                  </button>
                                  <button ng-if="file.typeFile=='application/pdf'" type="button" data-toggle="tooltip" data-placement="bottom" title="Ver archivo" class="btn btn-warning btn-xs" ng-click="openPDFViewerModal(file.urlFile)">
                                      <i class="far fa-eye"></i>
                                  </button>
                                  <button ng-if="sysLoggedUser.idProfileKf=='1' && tkupdate.billingReceiptDetails!=null && tkupdate.isBillingUploaded!=null && tkupdate.isBillingUploaded=='1'" type="button" data-toggle="tooltip" data-placement="bottom" title="Eliminar archivo" class="btn btn-danger btn-xs" ng-click="modalConfirmation('deleteSingleFile', 0, tkupdate.billingReceiptDetails[0])" >
                                      <i class="fas fa-trash-alt"></i>
                                  </button>
                                </div>                  
                              </li>
                            </ul>            
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12"> 
                        <!-- KEYS -->
                          <div ng-click="mainSwitchFn('ticket_keyList', tkupdate.keys, null)" style="margin-bottom: 1em;"
                          ng-class="{'col-md-3 col-xs-12':!tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1, 'col-md-2 col-xs-12':tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1}">
                              <div class="card-customer">
                                <div class="col-md-6 col-xs-6 n-padding-l card-icon">
                                    <i class="fas fa-key"></i>
                                </div>
                                <div class="col-md-6 col-xs-6 n-padding-r card-sticky" ng-class="{  
                                                'sticky-success': 
                                                tkupdate.keys.length>0,
                                                'sticky-warning':  
                                                tkupdate.keys.length==0,
                                              }">
                                  <span ng-if="tkupdate.keys.length>0">
                                    <i class="fas fa-check-circle"></i>
                                  </span>
                                  <span ng-if="tkupdate.keys.length==0" data-toggle="tooltip" data-placement="top" title="No se registran llaveros asociados al pedido">
                                    <i class="fas fa-exclamation-triangle"></i>
                                  </span>                    
                                </div>
                                <div class="col-md-12 card-title">
                                  <h4 class="text-uppercase right">Llaveros</h4>
                                </div>
                              </div>
                          </div>          
                        <!-- USER -->
                          <div ng-show="tkupdate.idTypeRequestFor=='1'" ng-click="mainSwitchFn('ticket_user', tkupdate, null)" style="margin-bottom: 1em;"
                          ng-class="{'col-md-3 col-xs-12':!tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1, 'col-md-2 col-xs-12':tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1}">
                              <div class="card-customer">
                                <div class="col-md-6 col-xs-6 n-padding-l card-icon">
                                    <i class="fas fas fa-user"></i> 
                                </div>
                                <div class="col-md-6 col-xs-6 n-padding-r card-sticky" ng-class="{  
                                                'sticky-success': 
                                                tkupdate.userRequestBy!=null && tkupdate.userMadeBy!=null,
                                                'sticky-warning':  
                                                tkupdate.userRequestBy==null,
                                              }">
                                  <span ng-if="tkupdate.userRequestBy!=null && tkupdate.userMadeBy!=null">
                                    <i class="fas fa-check-circle"></i>
                                  </span>
                                  <span ng-if="tkupdate.userRequestBy==null" data-toggle="tooltip" data-placement="top" title="Faltan datos del solicitante">
                                    <i class="fas fa-exclamation-triangle"></i>
                                  </span>
                                </div>
                                <div class="col-md-12 card-title">
                                  <h4 class="text-uppercase right">Usuario</h4>
                                </div>
                              </div>
                          </div>
                        <!-- DELIVERY -->
                          <div ng-if="tkupdate.idTypeTicketKf=='1'" ng-click="mainSwitchFn('ticket_delivery', tkupdate, null)" class="" style="margin-bottom: 1em;"
                          ng-class="{'col-md-3 col-xs-12':!tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1, 'col-md-2 col-xs-12':tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1}">
                              <div class="card-customer">
                                <div class="col-md-6 col-xs-6 n-padding-l card-icon">
                                    <i class="fas fa-truck"></i>
                                </div>
                                <div class="col-md-6 col-xs-6 n-padding-r card-sticky" ng-class="{  
                                                'sticky-success': 
                                                tkupdate.userDelivery!=null || tkupdate.deliveryAddress!=null || tkupdate.otherDeliveryAddress!=null || tkupdate.thirdPersonDelivery!=null,
                                                'sticky-warning': 
                                                tkupdate.userDelivery==null && tkupdate.deliveryAddress==null && tkupdate.otherDeliveryAddress==null && tkupdate.thirdPersonDelivery==null,
                                              }">
                                  <span ng-if="tkupdate.userDelivery!=null || tkupdate.deliveryAddress!=null || tkupdate.otherDeliveryAddress!=null || tkupdate.thirdPersonDelivery!=null">
                                    <i class="fas fa-check-circle"></i>
                                  </span>
                                  <span ng-if="tkupdate.userDelivery==null && tkupdate.deliveryAddress==null && tkupdate.otherDeliveryAddress==null && tkupdate.thirdPersonDelivery==null" data-toggle="tooltip" data-placement="top" title="Faltan datos de env챠o.">
                                    <i class="fas fa-exclamation-triangle"></i>
                                  </span>                                    
                                </div>
                                <div class="col-md-12 card-title">
                                  <h4 class="text-uppercase right">Env챠o</h4>
                                </div>
                              </div>
                          </div>
                        <!-- PAYMENTS -->
                          <div ng-if="tkupdate.paymentDetails!=null" ng-click="((tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2') || (tkupdate.idTypePaymentKf=='1' && tkupdate.idStatusTicketKf!='2'))?mainSwitchFn('ticket_payment', tkupdate, null):''" style="margin-bottom: 1em;"
                          ng-class="{'col-md-3 col-xs-12':!tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1, 'col-md-2 col-xs-12':tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1}">
                              <div class="card-customer">
                                <div class="col-md-6 col-xs-6 n-padding-l card-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="col-md-6 col-xs-6 n-padding-r card-sticky" ng-class="{  
                                                'sticky-success': 
                                                ((tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2') || (tkupdate.idTypePaymentKf=='1' && tkupdate.idStatusTicketKf!='2')),
                                                'sticky-warning':  
                                                tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails==null && tkupdate.idStatusTicketKf=='2',
                                              }">
                                  <span ng-if="((tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2') || (tkupdate.idTypePaymentKf=='1' && tkupdate.idStatusTicketKf!='2'))">
                                    <i class="fas fa-check-circle"></i>
                                  </span>
                                  <span ng-if="tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails==null && tkupdate.idStatusTicketKf=='2'" data-toggle="tooltip" data-placement="top" title="Pago pendiente por autorizaci처n del pedido">
                                    <i class="fas fa-exclamation-triangle"></i>
                                  </span>                                       
                                </div>
                                <div class="col-md-12 card-title">
                                  <h4 class="text-uppercase right">Pago</h4>
                                </div>
                              </div>
                          </div>
                        <!-- REFUNDS -->
                        <div ng-click="(tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2' && (tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1))?mainSwitchFn('ticket_refunds', tkupdate, null):''" class="col-md-2 col-xs-6" style="margin-bottom: 1em;" ng-if="tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2' && (tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1)">
                          <div class="card-customer">
                            <div class="col-md-6 col-xs-6 n-padding-l card-icon">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="col-md-6 col-xs-6 n-padding-r card-sticky" ng-class="{  
                                            'sticky-success': 
                                            (tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2' && (tkupdate.isHasRefundsOpen || tkupdate.refundsDetails.length>=1)),
                                            'sticky-warning':  
                                            tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails==null && tkupdate.idStatusTicketKf=='2',
                                          }">
                              <span ng-if="((tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails!=null && tkupdate.idStatusTicketKf!='2') || (tkupdate.idTypePaymentKf=='1' && tkupdate.idStatusTicketKf!='2'))">
                                <i class="fas fa-check-circle"></i>
                              </span>
                              <span ng-if="tkupdate.idTypePaymentKf=='2' && tkupdate.paymentDetails==null && !tkupdate.isHasRefundsOpen" data-toggle="tooltip" data-placement="top" title="">
                                <i class="fas fa-exclamation-triangle"></i>
                              </span>                                       
                            </div>
                            <div class="col-md-12 card-title">
                              <h4 class="text-uppercase right">Reintegro</h4>
                            </div>
                          </div>
                      </div>
                    </div>
                    <!-- TEMPORAL DELIVERY DATA REQUESTED -->
                    <br>
                    <div ng-if="tkupdate.idTmpDeliveryData && tkupdate.isChangeDeliverylRequested" class="container-fluid horizontal-line nopadding-containter">
                      <br>
                        <div class="col-md-12 col-xs-12 alert alert-warning">
                            <legend><i class="fas fa-edit"></i> Nuevos datos de env챠o</legend>
                            <div class="col-md-12 ">
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=1"><i class="fas fa-truck"></i> Entrega:&nbsp;
                                        <span style="color:rgb(250, 107, 107);background: #fff;border-radius: 10px;padding-left: 5px; padding-right: 5px; font-size: 11px;" ng-if="tkupdate.typeDelivery">{{tkupdate.tmp_nameTypeDelivery}}</span>
                                        <span ng-if="!tkupdate.typeDelivery" class="label label-default">n/a</span>
                                    </span>
                                </div>
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=1"><i class="fas fa-hand-holding"></i>
                                        <span ng-if="tkupdate.tmp_idTypeDeliveryKf==1"> Retirado por:&nbsp;</span>
                                        <span ng-if="tkupdate.tmp_idTypeDeliveryKf==2"> Recibido por:&nbsp;</span>
                                        <span ng-if="tkupdate.tmp_idTypeDeliveryKf==2 && tkupdate.tmp_idUserAttendantKfDelivery">{{tkupdate.tmp_nameAttendantDelivery}} (Encargado)</span>
                                        <span ng-if="tkupdate.tmp_idTypeDeliveryKf==1 && !tkupdate.tmp_idUserAttendantKfDelivery && !tkupdate.tmp_thirdPersonNames">Cliente Titular</span>
                                        <span ng-if="(tkupdate.tmp_idTypeDeliveryKf==1 || tkupdate.tmp_idTypeDeliveryKf==2) && !tkupdate.tmp_idUserAttendantKfDelivery && tkupdate.tmp_thirdPersonNames">{{tkupdate.thirdPersonNames}} (tercera persona)</span>
                                    </span>
                                </div>
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=2"><i class="fas fa-dollar-sign"></i> Costo:&nbsp;
                                        <span style="color:rgb(250, 107, 107);background: #fff;border-radius: 10px;padding-left: 5px; padding-right: 5px; font-size: 11px;" ng-if="tkupdate.typeDelivery">{{tkupdate.tmp_totalService | number:2}}</span>
                                        <span ng-if="!tkupdate.totalService" class="label label-default">n/a</span>
                                    </span>
                                </div>
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=2"><i class="fa fa-user"></i> Solicitado por:&nbsp;
                                        <span ng-if="tkupdate.tmp_idUserRequestChOrCancel">{{tkupdate.tmp_nameUserRequestChOrCancel}}</span>
                                        <span ng-if="!tkupdate.tmp_idUserRequestChOrCancel" class="label label-default">n/a</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- TEMPORAL CANCEL DATA REQUESTED -->
                    <br>
                    <div ng-if="tkupdate.idTmpDeliveryData && tkupdate.isCancelRequested" class="container-fluid horizontal-line nopadding-containter">
                      <br>
                        <div class="col-md-12 col-xs-12 alert alert-warning">
                            <legend><i style="color: #d43f3a;" class="fas fa-exclamation-triangle"></i> Solicitud de cancelacion de pedido</legend>
                            <div class="col-md-12 ">
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=2"><i class="fa fa-user"></i> Solicitado por:&nbsp;
                                        <span ng-if="tkupdate.tmp_idUserRequestChOrCancel">{{tkupdate.tmp_nameUserRequestChOrCancel}}</span>
                                        <span ng-if="!tkupdate.tmp_idUserRequestChOrCancel" class="label label-default">n/a</span>
                                    </span>
                                </div>
                                <div class="col-xs-12">
                                    <span><i class="far fa-calendar-alt"></i> Fecha de solicitud:&nbsp;
                                        <span ng-if="tkupdate.dateOfRequestByUser"> {{tkupdate.dateOfRequestByUser | dateToISO | date:'dd/MM/yyyy'}}</span>
                                        <span ng-if="!tkupdate.dateOfRequestByUser" class="label label-default">n/a</span>
                                    </span>
                                </div>
                                <div class="col-xs-12">
                                    <span ng-show="tkupdate.idTypeTicket<=3"><i class="far fa-comment-alt"></i> Motivo:&nbsp;
                                        <span ng-if="tkupdate.tmp_reasonForCancelTicket">{{tkupdate.tmp_reasonForCancelTicket}}</span>
                                        <span ng-if="!tkupdate.tmp_reasonForCancelTicket" class="label label-default">n/a</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
            <!-- TIMELINE TICKET HISTORY -->
            <div class="col-xs-12 col-sm-12"><div ng-include="'views/monitor/tickets/timeline_history.html'"></div></div>
            <div class="clearfix"> </div> 
        </div>
        <!-- Actions Button -->
        <div class="modal-footer">
            <div class="row">
                <!--<div ng-if="!tkupdate.idUserApprovedTicket" class="col-xs-6 col-sm-3 col-md-2">
                    <!--button type="submit" ng-click="sysUpdateFn()" ng-disabled="fUpdateUser.$invalid || ownerFound || emailFound" class="btn btn-labeled btn-success">
                        <span class="btn-label"><i class="glyphicon glyphicon-send"></i> </span>Actualizar</button>
                    <a ng-if="tkupdate.idTypeTicket>0 && (sessionidProfile==1 || sessionidProfile==4)" type="button" ng-click="tkupdate.idUserApprovedTicket? null : sysApproveTicketFn(tkupdate.idTicket, sessionIdUser);" class="btn btn-labeled btn-success" ng-disabled="tkupdate.idUserApprovedTicket || tkupdate.idUserCancelTicket">
                        <span class="btn-label"><i class="fas fa-check"></i></span>Aprobar</a>
                </div>-->
                <!--<div ng-if="tkupdate.idTypeTicket<=1" ng-class="!tkupdate.idUserApprovedTicket && tkupdate.idTypeTicket!=3?'col-xs-6 col-sm-3 col-md-2':'col-xs-6 col-sm-3 col-md-2'">
                    <a ng-if="tkupdate.idTypeTicket==1 && tkupdate.idStatusTicketKf!=5 && tkupdate.idStatusTicketKf!=6" type="button" ng-click="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6) || tkupdate.idStatusTicketKf==1 || tkupdate.idUserCancelTicket || tkupdate.isCancelRequested || tkupdate.isChangeDeliverylRequested ? null : openTicketFn(tkupdate, 1);" class="btn btn-labeled btn-warning" ng-disabled="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6)  || tkupdate.idStatusTicketKf==1 || tkupdate.idUserCancelTicket || tkupdate.isCancelRequested || tkupdate.isChangeDeliverylRequested">
                        <span class="btn-label"><i class="fas fa-truck"></i></span>Envio</a>
                </div>-->
                <!--<div ng-class="tkupdate.idUserApprovedTicket && tkupdate.idTypeTicket==3?'col-xs-6 col-sm-6 col-md-4':'col-xs-6 col-sm-3 col-md-2'">
                    <a ng-if="tkupdate.idStatusTicketKf!=5 && tkupdate.idStatusTicketKf!=6" data-dismiss="modal" type="button" ng-click="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6) || tkupdate.idStatusTicketKf==1 || tkupdate.idUserCancelTicket || tkupdate.isCancelRequested ? null : openTicketFn(tkupdate, 2);"  class="btn btn-labeled btn-danger" ng-disabled="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6) || tkupdate.idStatusTicketKf==1 || tkupdate.idUserCancelTicket || tkupdate.isCancelRequested || tkupdate.isChangeDeliverylRequested">
                        <span class="btn-label" ><i class="fas fa-ban"></i></span>Cancelar</a>
                </div>-->
                <div class="col-xs-10 col-sm-10 col-md-10">
                  <div ng-if="sysLoggedUser.idProfileKf=='1' && tkupdate.idTypePaymentKf=='2' && (tkupdate.billingReceiptDetails==undefined || tkupdate.billingReceiptDetails==null) && (tkupdate.isBillingUploaded==undefined || tkupdate.isBillingUploaded==null || tkupdate.isBillingUploaded=='0') && (tkupdate.idStatusTicketKf==1 || tkupdate.idStatusTicketKf==4 || tkupdate.idStatusTicketKf==5 || tkupdate.idStatusTicketKf==8) && tkupdate.idStatusTicketKf!=6 && tkupdate.isCancelRequested!='1'" class="col-xs-3 col-sm-4 col-md-2">
                    <button for="uploadTicketBillingFile" class="btn btn-labeled btn-file btn-warning"><span class="btn-label"><i class="fas fa-file-invoice"></i></span>Subir Factura
                      <input id="uploadTicketBillingFile" name="uploadTicketBillingFile" type="file" class="form-control" accept="*/*" onchange="angular.element(this).scope().loadPDFFilesFn(this)" ng-model="filesInput" />
                    </button>
                  </div>
                  <!-- UPLOAD TICKET BILL -->
                  <div ng-if="sysLoggedUser.idProfileKf=='1' && tkupdate.billingReceiptDetails!=undefined && tkupdate.billingReceiptDetails!=null && tkupdate.isBillingUploaded!=undefined && tkupdate.isBillingUploaded!=null && tkupdate.isBillingUploaded=='1' && tkupdate.isCancelRequested!='1'" class="col-xs-3 col-sm-4 col-md-2">
                    <a id="removeBillingFile" ng-click="modalConfirmation('deleteSingleFile', 0, tkupdate.billingReceiptDetails[0])" type="button" class="btn btn-labeled btn-danger">
                      <span class="btn-label"><i class="fas fa-trash-alt"></i></span>Borrar Factura</a>
                  </div>
                  <!-- APPROVE TICKET -->
                  <div ng-if="(tkupdate.idStatusTicketKf==2 || tkupdate.idStatusTicketKf==9 || tkupdate.idStatusTicketKf==11) && (sysLoggedUser.idProfileKf=='1' || sysLoggedUser.idProfileKf=='4') && tkupdate.isCancelRequested!='1'" class="col-xs-3 col-sm-4 col-md-2 ">
                    <a id="approveTicket" ng-click="tkupdate.isCancelRequested?'':mainSwitchFn('approveTicket', tkupdate)" type="button" class="btn btn-labeled btn-success">
                      <span class="btn-label"><i class="fas fa-check"></i></span>Aprobar</a>
                  </div>
                  <!-- REJECT CANCEL REQUEST -->
                  <div ng-if="(sysLoggedUser.idProfileKf==1 || sysLoggedUser.idProfileKf==4) && tkupdate.idTypeTicketKf<2 && tkupdate.idStatusTicketKf!=6 && tkupdate.isCancelRequested=='1'" class="col-xs-3 col-sm-4 col-md-2">
                    <a id="cancelTicket" ng-click="modalConfirmation('reject_cancel_user',0, tkupdate)" type="button" class="btn btn-labeled btn-warning">
                      <span class="btn-label"><i class="fas fa-window-close"></i></span>Rechazar</a>
                  </div>
                  <!-- REQUEST CANCEL -->
                  <div ng-if="tkupdate.idStatusTicketKf!=6 && tkupdate.idStatusTicketKf!=1 && tkupdate.isCancelRequested!=1 && (sysLoggedUser.idProfileKf=='3') || ((sysLoggedUser.idProfileKf=='5') && sysLoggedUser.idTypeTenantKf!=null)" class="col-xs-3 col-sm-4 col-md-2">
                    <a id="cancelTicket" ng-click="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6)  || tkupdate.idStatusTicketKf==1 || tkupdate.isCancelRequested?'':modalConfirmation('cancel_user',0, tkupdate)" ng-disabled="(tkupdate.idStatusTicketKf>=5 && tkupdate.idStatusTicketKf<=6)  || tkupdate.idStatusTicketKf==1 || tkupdate.isCancelRequested" type="button" class="btn btn-labeled btn-danger">
                      <span class="btn-label"><i class="fas fa-ban"></i></span>Cancelar</a>
                  </div>
                  <!-- CANCEL TICKET -->
                  <div ng-if="((tkupdate.idStatusTicketKf!=6 && tkupdate.idStatusTicketKf!=1) ||  (tkupdate.idStatusTicketKf==10 && tkupdate.isCancelRequested==1)) && (sysLoggedUser.idProfileKf=='1' || sysLoggedUser.idProfileKf=='4')" class="col-xs-3 col-sm-4 col-md-2">
                    <a id="cancelTicket" ng-click="modalConfirmation('cancel_sys',0, tkupdate)" type="button" class="btn btn-labeled btn-danger">
                      <span class="btn-label"><i class="fas fa-ban"></i></span>Cancelar</a>
                  </div>
                  <!-- CHANGE DELIVERY -->
                  <div ng-if="tkupdate.idTypeTicketKf=='1' && tkupdate.idStatusTicketKf!=1 && tkupdate.idStatusTicketKf!=5 && tkupdate.idStatusTicketKf!=6 && tkupdate.isCancelRequested!=1 && tkupdate.isDeliveryHasChanged!=1" class="col-xs-3 col-sm-4 col-md-2">
                    <a id="deliveryChange" ng-click="mainSwitchFn('ticket_delivery_change', tkupdate, null)" type="button" class="btn btn-labeled btn-info">
                      <span class="btn-label"><i class="fas fa-truck"></i></span>Cambiar env챠o</a>
                  </div>
                </div> 
                <div class="col-xs-2 col-sm-2 col-md-2 pull-right">
                  <div class="col-xs-12 col-sm-12 col-md-12 pull-right">
                    <a id="cancelModalWindow" data-dismiss="modal" type="button" class="btn btn-labeled btn-danger">
                        <span class="btn-label"><i class="glyphicon glyphicon-remove"></i></span>Cerrar</a>
                  </div>
                </div> 
            </div>
        </div>
    </div>
</div>
</div>
<!-- KE LIST-->
<div ng-if="sysToken" ng-include="'views/monitor/tickets/lists/ticketKeyList.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/lists/refundsList.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/delivery_details.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/user_details.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/payment_details.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/delivery_update.html'"></div>
<div ng-if="sysToken" ng-include="'views/monitor/tickets/register_manual_payment.html'"></div>
<div ng-include="'views/utilities/modalConfirmation.html'"></div>
<div ng-include="'views/utilities/showModalRequestStatus.html'"></div>
<div ng-include="'views/utilities/pdfUploadModal.html'"></div>